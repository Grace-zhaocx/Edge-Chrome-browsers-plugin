# 飞书知识收藏插件需求文档

## 一、需求背景
在日常阅读过程中，经常会在网页上遇到优质的文章、资讯或资料，希望能快速保存并沉淀到知识库。目前手动复制粘贴到飞书多维表格效率低，体验差，容易遗漏。

因此需要开发一个 Chrome 浏览器插件，实现**一键收藏网页文章信息并同步到飞书多维表格**，方便后续在飞书中统一管理和查阅。

## 二、需求目标

### 2.1 核心目标
1. 用户在Chrome浏览器中点击插件按钮，快速保存当前网页信息
2. 数据自动同步到指定的飞书多维表格
3. 支持用户自定义编辑和分类
4. 提供友好的操作反馈

### 2.2 数据字段定义

**插件收集字段：**
- 网站地址 (URL) - 自动获取
- 网站标题 - 自动获取页面title
- 网站说明 - 用户可编辑的中文描述
- 网站备注 - 用户补充信息
- 网站标签 - 分类标签，支持多标签输入
- 页面摘要 - 用户选中的文字（可选）
- 创建时间 - 自动添加

**飞书表格字段：**
```
字段名称        字段类型    是否必填    说明
网站地址        文本        是         页面URL
网站标题        文本        是         页面title
网站说明        文本        否         用户描述
网站备注        多行文本     否         详细备注
网站标签        多选        否         分类标签
页面摘要        多行文本     否         选中内容
创建时间        日期时间     是         收藏时间
```

## 三、功能需求

### 3.1 核心功能

#### 3.1.1 网页收藏
**触发方式：**
- 点击插件图标
- 快捷键 Ctrl+Shift+S（后续版本）

**数据获取：**
- 自动获取：页面URL、页面标题、当前时间
- 智能获取：页面选中文字作为摘要
- 用户输入：网站说明、备注、标签

**用户界面：**
- 弹窗尺寸：400px × 500px
- 显示预填充信息
- 提供编辑和确认操作
- 支持标签的增删改

#### 3.1.2 重复检测
- 根据URL检测是否已收藏
- 已收藏：显示提示，询问是否更新
- 未收藏：正常收藏流程

#### 3.1.3 数据同步
- 调用飞书多维表格API保存数据
- 支持离线缓存（网络异常时）
- 重试机制：最多3次

#### 3.1.4 状态反馈
**成功状态：**
- 显示"收藏成功"提示
- 显示飞书表格链接（可选）

**失败状态：**
- 网络错误：提示重试
- API错误：显示具体错误信息
- Token过期：引导重新配置

### 3.2 配置功能

#### 3.2.1 基础配置
- 飞书App ID和App Secret
- Base ID和Table ID
- API Token管理

#### 3.2.2 高级配置
- 默认标签设置
- 自动填充规则
- 快捷键自定义

#### 3.2.3 存储方案
- 使用 `chrome.storage.sync` 跨设备同步配置
- 敏感信息（Token）使用 `chrome.storage.local`
- 配置数据加密存储

### 3.3 扩展功能（后续版本）

#### 3.3.1 批量操作
- 批量收藏（从历史记录/书签导入）
- 批量编辑标签
- 数据导出功能

#### 3.3.2 智能功能
- 基于内容的自动标签建议
- 相似内容检测
- 阅读时长记录

## 四、技术实现

### 4.1 技术架构

#### 4.1.1 插件结构
```
chrome-extension/
├── manifest.json           # 插件配置
├── background.js          # 后台脚本
├── content-script.js      # 内容脚本
├── popup/
│   ├── popup.html        # 弹窗界面
│   ├── popup.js          # 弹窗逻辑
│   └── popup.css         # 样式
├── options/
│   ├── options.html      # 设置页面
│   ├── options.js        # 设置逻辑
│   └── options.css       # 样式
├── utils/
│   ├── api.js           # API调用封装
│   ├── storage.js       # 存储操作
│   └── utils.js         # 工具函数
└── assets/
    ├── icons/           # 图标文件
    └── styles/          # 公共样式
```

#### 4.1.2 关键权限
```json
{
  "permissions": [
    "activeTab",
    "storage",
    "https://open.feishu.cn/*"
  ],
  "host_permissions": [
    "https://open.feishu.cn/*"
  ]
}
```

### 4.2 API集成

#### 4.2.1 飞书API接口
**认证：**
- 获取tenant_access_token: `POST /open-apis/auth/v3/tenant_access_token/`

**数据操作：**
- 新增记录: `POST /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records`
- 查询记录: `GET /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records`

#### 4.2.2 错误处理
```javascript
const API_ERRORS = {
  1001: '无效的App ID',
  1002: 'Token过期',
  1003: '权限不足',
  1004: '请求频次超限',
  1005: '表格不存在'
}
```

### 4.3 数据流程

#### 4.3.1 收藏流程
```
用户点击插件 → 获取页面信息 → 显示编辑界面 → 
用户确认 → 调用飞书API → 返回结果 → 显示状态
```

#### 4.3.2 配置流程
```
打开设置页 → 输入配置信息 → 验证有效性 → 
保存到本地存储 → 更新插件状态
```

## 五、用户体验设计

### 5.1 界面设计原则
- 简洁明了，突出核心功能
- 操作步骤不超过3步
- 提供清晰的状态反馈
- 支持键盘快捷操作

### 5.2 交互设计
**弹窗交互：**
- ESC键关闭弹窗
- Enter键快速保存
- Tab键焦点切换

**状态指示：**
- Loading状态显示
- 成功/失败图标
- 进度条显示

## 六、性能与安全

### 6.1 性能要求
- 插件大小 < 5MB
- 弹窗打开时间 < 500ms
- API响应处理 < 2s
- 内存占用 < 50MB

### 6.2 安全要求
- API Token本地加密存储
- HTTPS通信
- 输入数据验证
- XSS防护

## 七、测试计划

### 7.1 功能测试
- 基础收藏功能
- 重复检测机制
- 配置管理
- 错误处理

### 7.2 兼容性测试
- Chrome版本兼容（Chrome 88+）
- 不同操作系统（Windows/Mac/Linux）
- 网络环境测试

### 7.3 性能测试
- 大量数据处理
- 网络异常情况
- 内存泄漏检测

## 八、部署与发布

### 8.1 开发环境
- Node.js 18+
- Chrome Extension开发工具
- Git版本控制

### 8.2 发布流程
1. 代码构建和打包
2. Chrome Web Store上传
3. 版本更新机制
4. 用户反馈收集

## 九、后续扩展

### 9.1 多浏览器支持
- Edge浏览器适配
- Firefox扩展版本

### 9.2 多平台集成
- Notion同步
- 语雀集成
- Confluence支持

### 9.3 高级功能
- AI内容分析
- 自动分类
- 协作共享